<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">

        <record id="send_lead_sms" model="base.automation">
            <field name="name">ShareVault: send SMS to team</field>
            <field name="model_id" ref="crm.model_crm_lead"/>
            <field name="trigger">on_create</field>
            <field name="active" eval="True"/>
            <field name="state">code</field>
            <field name="code">
if record.team_id:
    for tm in record.team_id.member_ids:
        if tm.mobile:
            base_url = request.env['ir.config_parameter'].get_param('web.base.url')
            base_url += '/web#id=%d&amp;view_type=form&amp;model=%s' % (record.id, record._name)
            env['sms.sms'].create({
                                    'number': tm.mobile,
                                    'body': 'New lead! %s' % base_url
                                    })
            </field>
        </record>
        <!-- Automated Action for Update Lead stages based on the score and lead type -->
        <record id="update_lead_stages" model="base.automation">
            <field name="name">ShareVault: Update Lead Stages</field>
            <field name="model_id" ref="crm.model_crm_lead"/>
            <field name="trigger">on_write</field>
            <field name="active" eval="True"/>
            <field name="state">code</field>
            <field name="code">
if record.type == 'lead':
    if record.lead_type == 'new' and record.score >= 40:
        stage = env['crm.stage'].search([('name', '=', 'Open')], limit=1)
        record.write({'stage_id': stage.id,
                       'lead_type': 'marketing_ql'})
        record.create_lead_sf()
            </field>
        </record>

        <record id="assign_contact_from_lead" model="base.automation">
            <field name="name">ShareVault: Assign Contact in Lead</field>
            <field name="model_id" ref="crm.model_crm_lead"/>
            <field name="trigger">on_create</field>
            <field name="active" eval="True"/>
            <field name="state">code</field>
            <field name="code">
if record:
    record.assign_contact_lead()
            </field>
        </record>

        <!--<record id="ir_cron_lead_stage_update" model="ir.cron">
            <field name='name'>CRM: Update Lead Stages</field>
            <field name='interval_number'>1</field>
            <field name='interval_type'>days</field>
            <field name="numbercall">-1</field>
            <field name="active" eval="True"/>
            <field name="doall" eval="False"/>
            <field name="code">model.update_lead_stages()</field>
            <field name="state">code</field>
            <field name="model_id" ref="model_crm_lead"/>
        </record>-->



        <record id="assign_user_to_lead" model="base.automation">
            <field name="name">ShareVault: assign salesperson</field>
            <field name="model_id" ref="crm.model_crm_lead"/>
            <field name="trigger">on_create</field>
            <field name="active" eval="True"/>
            <field name="state">code</field>
            <field name="code">
if record.type == 'lead' and not record.user_id:
  if record.team_id and record.team_id.alias_user_id:
    user_id = record.team_id.alias_user_id
    record.write({'user_id':user_id})
    notify_data = dict()
    new_partners = dict()
    new_channels = dict()
    res = record._message_auto_subscribe_followers({'user_id':user_id.id}, False)
    for pid, sids, template in res:
        new_partners.setdefault(pid, sids)
        if template:
            partner = env['res.partner'].browse(pid)
            lang = partner.lang if partner else None
            notify_data.setdefault((template, lang), list()).append(pid)
        record.message_subscribe([pid])
    for (template, lang), pids in notify_data.items():
        record._message_auto_subscribe_notify(pids, template)
            </field>
        </record>



    </data>
</odoo>
