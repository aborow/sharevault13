<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record id="crm_case_tree_view_leads_2" model="ir.ui.view">
            <field name="name">Show source</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_tree_view_leads"/>
            <field name="arch" type="xml">
                <xpath expr="//field[last()]" position="after">
                    <field name="source_id" optional="false"/>
                </xpath>
            </field>
        </record>


        <record id="view_crm_stage_inherited" model="ir.ui.view">
            <field name="name">Crm Stage inherit</field>
            <field name="model">crm.stage</field>
            <field name="priority">1</field>
            <field name="inherit_id" ref="crm.crm_stage_form"/>
            <field name="arch" type="xml">
                <xpath expr="//form/sheet/group/group/field[@name='is_won']" position="after">
                    <field name="is_lead_stage"/>
                    <field name="is_recycle_stage"/>
                </xpath>
                <xpath expr="//field[@name='is_won']" position="attributes">
                    <attribute name="attrs">{'invisible': [('is_lead_stage','=',True)]}</attribute>
                </xpath>
            </field>
        </record>


        <record id="view_crm_case_leads_filter" model="ir.ui.view">
            <field name="name">ShareVault: add fields to search</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.view_crm_case_leads_filter"/>
            <field name="arch" type="xml">
                <xpath expr="//field[last()]" position="after">
                    <field name="request_type"/>
                    <field name="source_id"/>
                </xpath>
                <xpath expr="//group/filter[last()]" position="after">
                    <filter string="Request Type" name="group_by_request_type"
                            context="{'group_by':'request_type'}"/>
                    <filter string="Source" name="group_by_source"
                            context="{'group_by':'source_id'}"/>
                </xpath>
            </field>
        </record>




        <record id="view_crm_lead_form_inherited" model="ir.ui.view">
            <field name="name">crm.lead.form.inherit</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_lead_view_form"/>
            <field name="arch" type="xml">
                <xpath expr="//form/sheet/group/group/field[@name='lang_id']" position="after">
                    <field name="lead_type"/>
                    <field name="is_lead_stage" invisible="1"/>
                    <field name="stage_ids" invisible="1" widget="many2many_tags"/>
                </xpath>
                <xpath expr="//form/header/button[@name='%(crm.action_crm_lead2opportunity_partner)d']"
                       position="attributes">
                    <attribute name="attrs">{'invisible': ['|','|',('lead_type','in',['new',False]),('active', '=', False),('type', '=',
                        'opportunity')]}
                    </attribute>
                </xpath>
                <xpath expr="//form/header/field[@name='stage_id']" position="attributes">
                    <attribute name="attrs">{'invisible': [('active', '=', False)]}</attribute>
                </xpath>
                <xpath expr="//form/header/field[@name='stage_id']" position="attributes">
                    <attribute name="domain">['&amp;',('id','in',stage_ids),'|',('team_id', '=', team_id), ('team_id', '=', False)]</attribute>
                </xpath>

                <xpath expr="//field[@name='mobile']" position="after">
                    <field name="european_union"/>
                    <field name="accept_conditions"/>
                    <field name="request_type"/>
                </xpath>
                <xpath expr="//form/sheet/notebook/page[@name='extra']" position="after">
                    <page name="sales_force" string="Salesforce" attrs="{'invisible': [('type', '=', 'opportunity')]}">
                        <group>
                            <group>
                                <field name="x_salesforce_id" readonly="1"/>
                                <field name="x_salesforce_exported" readonly="1"/>
                                <field name="x_is_updated" invisible="1"/>
                                <field name="x_last_modified_on" readonly="1"/>
                                <field name="salesforce_response" readonly="1"/>
                            </group>
                        </group>
                    </page>
                 </xpath>
            </field>
        </record>

        <record id="view_crm_stage_tree_inherited" model="ir.ui.view">
            <field name="name">Crm Stage inherit</field>
            <field name="model">crm.stage</field>
            <field name="priority">16</field>
            <field name="inherit_id" ref="crm.crm_stage_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='is_won']" position="after">
                    <field name="is_lead_stage"/>
                </xpath>
            </field>
        </record>

        <record id="quick_create_opportunity_form_modified" model="ir.ui.view">
            <field name="name">crm.lead.form.quick_create</field>
            <field name="model">crm.lead</field>
            <field name="priority">1000</field>
            <field name="arch" type="xml">
                <form>
                    <group>
                        <field name="name" string="Lead"/>
                        <field name="partner_id" widget="res_partner_many2one"
                               context="{'res_partner_search_mode': 'customer', 'show_vat': True}"/>
                        <field name="planned_revenue" widget="monetary"
                               options="{'currency_field': 'company_currency'}"/>
                        <field name="company_currency" invisible="1"/>
                        <field name="company_id" invisible="1"/>
                        <field name="priority" nolabel="1" widget="priority"/>
                    </group>
                </form>
            </field>
        </record>


        <record id="crm_case_kanban_view_leads_modified" model="ir.ui.view">
            <field name="name">crm.lead.kanban.lead</field>
            <field name="model">crm.lead</field>
            <field name="priority" eval="1"/>
            <field name="arch" type="xml">
                <kanban default_group_by="stage_id" class="o_kanban_small_column o_opportunity_kanban"
                        on_create="quick_create"
                        quick_create_view="wibtec_custom_lead.quick_create_opportunity_form_modified"
                        archivable="false">
                    <field name="stage_id" options='{"group_by_tooltip": {"requirements": "Description"}}' domain="[]"/>
                    <field name="color"/>
                    <field name="priority"/>
                    <field name="planned_revenue"/>
                    <field name="kanban_state"/>
                    <field name="activity_date_deadline"/>
                    <field name="user_email"/>
                    <field name="user_id"/>
                    <field name="partner_address_email"/>
                    <field name="message_needaction_counter"/>
                    <field name="partner_id"/>
                    <field name="activity_summary"/>
                    <field name="active"/>
                    <field name="company_currency"/>
                    <field name="activity_state"/>
                    <field name="activity_ids"/>
                    <progressbar field="activity_state"
                                 colors='{"planned": "success", "today": "warning", "overdue": "danger"}'
                                 sum_field="planned_revenue"
                                 help="This bar allows to filter the opportunities based on scheduled activities."/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="#{!selection_mode ? kanban_color(record.color.raw_value) : ''} oe_kanban_global_click">
                                <div class="o_dropdown_kanban dropdown">

                                    <a class="dropdown-toggle o-no-caret btn" role="button" data-toggle="dropdown"
                                       data-display="static" href="#" aria-label="Dropdown menu" title="Dropdown menu">
                                        <span class="fa fa-ellipsis-v"/>
                                    </a>
                                    <div class="dropdown-menu" role="menu">
                                        <t t-if="widget.editable">
                                            <a role="menuitem" type="edit" class="dropdown-item">Edit</a>
                                        </t>
                                        <t t-if="widget.deletable">
                                            <a role="menuitem" type="delete" class="dropdown-item">Delete</a>
                                        </t>
                                        <ul class="oe_kanban_colorpicker" data-field="color"/>
                                    </div>
                                </div>
                                <div class="oe_kanban_content">
                                    <div>
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                    </div>
                                    <div>
                                        <field name="tag_ids" widget="many2many_tags"
                                               options="{'color_field': 'color'}"/>
                                    </div>
                                    <div class="text-muted o_kanban_record_subtitle">
                                        <t t-if="record.planned_revenue.raw_value">
                                            <field name="planned_revenue" widget="monetary"
                                                   options="{'currency_field': 'company_currency'}"/>
                                            <span t-if="record.partner_id.value">,</span>
                                        </t>
                                        <span t-if="record.partner_id.value">
                                            <t t-esc="record.partner_id.value"/>
                                        </span>
                                    </div>

                                    <div class="o_kanban_record_bottom">
                                        <div class="oe_kanban_bottom_left">
                                            <field name="priority" widget="priority" groups="base.group_user"/>
                                            <t t-if="record.message_needaction_counter.raw_value">
                                                <span role="alert" class='oe_kanban_mail_new' title='Unread Messages'>
                                                    <i class='fa fa-comments' aria-label="Unread messages" role="img"/>
                                                    <t t-raw="record.message_needaction_counter.raw_value"/>
                                                </span>
                                            </t>
                                            <field name="activity_ids" widget="kanban_activity"/>
                                        </div>
                                        <div class="oe_kanban_bottom_right">
                                            <img t-att-src="kanban_image('res.users', 'image_128', record.user_id.raw_value)"
                                                 t-att-title="record.user_id.value" t-att-alt="record.user_id.value"
                                                 class="oe_kanban_avatar"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="oe_clear"/>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Lead Menu -->
        <record model="ir.actions.act_window" id="crm.crm_lead_all_leads">
            <field name="name">Leads</field>
            <field name="res_model">crm.lead</field>
            <field name="view_mode">kanban,tree,graph,pivot,calendar,form,activity</field>
            <field name="domain">['|', ('type','=','lead'), ('type','=',False)]</field>
            <field name="search_view_id" ref="crm.view_crm_case_leads_filter"/>
            <field name="context">{
                'default_type':'lead',
                'search_default_type': 'lead',
                'search_default_to_process':1,
                'default_is_lead_stage': True,
                }
            </field>
        </record>
        <!--('is_lead_stage','=',True),-->
        <record id="crm.crm_lead_all_leads_view_kanban" model="ir.actions.act_window.view">
            <field name="sequence" eval="1"/>
            <field name="view_mode">kanban</field>
            <field name="view_id" ref="crm_case_kanban_view_leads_modified"/>
            <field name="act_window_id" ref="crm.crm_lead_all_leads"/>
        </record>

        <record id="crm.crm_lead_all_leads_view_tree" model="ir.actions.act_window.view">
            <field name="sequence" eval="2"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="crm.crm_case_tree_view_leads"/>
            <field name="act_window_id" ref="crm.crm_lead_all_leads"/>
        </record>

        <record id="view_crm_lead_inherited_score" model="ir.ui.view">
            <field name="name">crm lead inherit for score</field>
            <field name="model">crm.lead</field>
            <field name="priority">16</field>
            <field name="inherit_id" ref="website_crm_score.lead_score_form"/>
            <field name="arch" type="xml">
                <xpath expr="//form[1]/sheet[1]/notebook[1]/page[@name='lead']/group[1]/group[not(@name)][4]" position="replace"/>
                <xpath expr="//group[@name='lead_priority']/field[@name='score']" position="after">
                        <button string="Recycle Lead Score" type="object"
                                name="update_lead_score"
                                attrs="{'invisible':['|',('type','=','opportunity'),('score','=',0.0)]}"
                                class="oe_link oe_inline" />
                </xpath>
            </field>
        </record>

        <record id="view_crm_lead_inherited_score_move" model="ir.ui.view">
            <field name="name">crm lead inherit for score</field>
            <field name="model">crm.lead</field>
            <field name="priority">16</field>
            <field name="inherit_id" ref="crm.crm_lead_view_form"/>
            <field name="arch" type="xml">
                <xpath expr="//form/sheet/group/group[7]/field[@name='company_id']" position="after">
                        <separator string="Scoring"/>
                        <field name="score"/>
                        <button string="Recycle Lead Score" type="object"
                                name="update_lead_score"
                                attrs="{'invisible':['|',('type','=','lead'),('score','=',0.0)]}"
                                class="oe_link oe_inline" />
                        <field name="score_ids" widget="many2many_tags" domain="[('object_id.model','=','crm.lead')]"
                               context="{'object_name': 'crm.lead'}" readonly="1"/>
                </xpath>
            </field>
        </record>

        <record model="ir.actions.server" id="action_recycle_score_to_zero">
            <field name="name">Recycle Lead Score</field>
            <field name="model_id" ref="model_crm_lead"/>
            <field name="binding_model_id" ref="model_crm_lead"/>
            <field name="state">code</field>
            <field name="code">
                if records:
                action = records.update_recycle_lead_score()
            </field>
        </record>

        <record model="ir.actions.act_window" id="crm.crm_lead_action_pipeline">
            <field name="name">Opportunities</field>
            <field name="res_model">crm.lead</field>
            <field name="view_mode">kanban,tree,graph,pivot,form,calendar,activity</field>
            <field name="domain">[('type','=','opportunity')]</field>
            <field name="context">{
                    'default_type': 'opportunity',
                    'search_default_assigned_to_me': 1
            }</field>
            <field name="search_view_id" ref="crm.view_crm_case_opportunities_filter"/>
        </record>

        <menuitem id="crm_menu_opportunities_custom"
                  name="Opportunities"
                  parent="crm.crm_menu_leads"
                  action="crm.crm_lead_action_pipeline"
                  sequence="1"
                  groups="sales_team.group_sale_manager"/>

        <record id="utm_campaign_action_in_lead" model="ir.actions.act_window">
            <field name="name">Campaigns</field>
            <field name="res_model">utm.campaign</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Define a new UTM campaign
                </p>
            </field>
        </record>

        <menuitem id="menu_utm_campaign_act_in_lead"
            action="utm_campaign_action_in_lead"
            parent="crm.crm_menu_config"
            sequence="10"
            />

        <menuitem id="menu_utm_medium_in_lead"
            action="utm.utm_medium_action"
            parent="crm.crm_menu_config"
            sequence="11"
            />

        <menuitem id="menu_utm_source_in_lead"
            action="utm.utm_source_action"
            parent="crm.crm_menu_config"
            sequence="12"
            />


    </data>
</odoo>
