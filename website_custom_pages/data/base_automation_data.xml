<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">

        <record id="send_thankyou_email" model="base.automation">
            <field name="name">ShareVault: send thank you email</field>
            <field name="model_id" ref="crm.model_crm_lead"/>
            <field name="trigger">on_create</field>
            <field name="active" eval="True"/>
            <field name="state">code</field>
            <field name="code">
if record.typ_id and record.typ_id.mail_template_id:
    template = record.typ_id.mail_template_id
    values = template.generate_email(record.id, fields=None)
    values['body_html'] = record.typ_id.text
    mail_mail_obj = env['mail.mail']
    msg_id = mail_mail_obj.create(values)
    if msg_id:
        mail_mail_obj.send(msg_id)
            </field>
        </record>



        <record id="send_confirmation_email" model="base.automation">
            <field name="name">ShareVault: send confirmation email</field>
            <field name="model_id" ref="crm.model_crm_lead"/>
            <field name="trigger">on_create</field>
            <field name="active" eval="True"/>
            <field name="state">code</field>
            <field name="code">
if record.typ_id and record.typ_id.mail_template_id:
    template = record.typ_id.mail_template_id
    values = template.generate_email(record.id, fields=None)
    mail_mail_obj = env['mail.mail']
    msg_id = mail_mail_obj.create(values)
    if msg_id:
        mail_mail_obj.send(msg_id)
            </field>
        </record>


        <record id="create_tracked_link" model="base.automation">
            <field name="name">ShareVault: create tracked link for shared link</field>
            <field name="model_id" ref="documents.model_documents_share"/>
            <field name="trigger">on_create</field>
            <field name="active" eval="True"/>
            <field name="state">code</field>
            <field name="code">
url = env['link.tracker'].sudo().create({
                                        'title': record.name,
                                        'url': record.full_url
                                        })
if url:
    record.write({'tracked_link_id':url.id})
            </field>
        </record>


        <record id="set_shared_link" model="base.automation">
            <field name="name">ShareVault: set shared link in lead</field>
            <field name="model_id" ref="crm.model_crm_lead"/>
            <field name="trigger">on_create</field>
            <field name="active" eval="True"/>
            <field name="state">code</field>
            <field name="code">
if record.typ_id and record.typ_id.shared_link_id:
    record.write({'share_link_id':record.typ_id.shared_link_id.id})
            </field>
        </record>



<!--
        <record id="send_link_whitepaper" model="base.automation">
            <field name="name">ShareVault: send link for white paper</field>
            <field name="model_id" ref="crm.model_crm_lead"/>
            <field name="trigger">on_create</field>
            <field name="active" eval="True"/>
            <field name="state">code</field>
            <field name="code">
if record.source_id \
    and record.source_id.name.strip().startswith('WEB_whitepaper')\
    and record.share_link_id:
    # Create a tracked URL
    url = env['link.tracker'].sudo().create({
                                            'title': 'White paper for %s (%s)' % (record.contact_name, record.id),
                                            'url': record.share_link_id.full_url
                                            })
    if url:
        # Save the tracked URL into the lead
        record.write({'tracked_link_id': url.id})

        # Send the URL using an email template
        template = env['mail.template'].search([('name','=','ShareVault: send white paper link')])
        if template:
            values = template.generate_email(record.id, fields=None)
            mail_mail_obj = env['mail.mail']
            msg_id = mail_mail_obj.create(values)
            if msg_id:
                mail_mail_obj.send(msg_id)
            </field>
        </record>
-->

    </data>
</odoo>
